<!DOCTYPE html>
<html lang="en">
<head>
    <title>YogsStats</title>
    <link rel="stylesheet" href="index.css" type="text/css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages': ['corechart']}).then(
            async function drawChart() {
                console.log("Fetching API meta data")
                        const response = await fetch("http://localhost:5001/stats/ttt/teamWinPercentage", {
                        method: 'GET',
                        mode: 'cors',
                    })

                const json = await response.json()

                dataArray = [["Team", "Win percentage"]]

                for (var key in json['teams']) {
                    dataArray.push([key, json['teams'][key]])
                }

                var data = google.visualization.arrayToDataTable(dataArray);

                var options = {
                title: 'Team win percentages',
                titleTextStyle: {
                    color: "white"
                },
                backgroundColor: "#1c2833",
                legend: {
                    textStyle: {
                        color: 'white'
                    }
                }
            };

            var chart = new google.visualization.PieChart(document.getElementById('team-piechart'));

            chart.draw(data, options);
        }
        )
    </script>
</head>
<body>
    <header class="flex-header">
        <div class="title">
            YogsStats
        </div>
        <div id="meta-info" class="meta-info">
            <script>
                async function fetchMetaData() {
                    console.log("Fetching API meta data")
                        const response = await fetch("http://localhost:5001/stats/ttt/meta", {
                        method: 'GET',
                        mode: 'cors',
                    })

                    const json = await response.json()
                    
                    const roundCount = json['roundCount']
                    const oldestDate = json['oldestRound']['date']
                    const newestDate = json['newestRound']['date']

                    document.getElementById("meta-info").innerText = `Total rounds tracked by API: ${roundCount}, oldest round added on ${oldestDate} & newest round added on ${newestDate}.`;
                }

                fetchMetaData()
            </script>
        </div>
    </header>
    <main class="flex-main">
        <nav class="flex-nav">
            SIDENAV
        </nav>
        <article class="flex-article">
            <div id="team-piechart" style="width: 900px; height: 500px;"></div>
        </article>
    </main>
    <footer class="flex-footer">
        FOOTER
    </footer>
</body>